# Описание API
Здесь описано всё АПИ, используемое в приложении, с описанием структур данных


**Содержание**
1. Общее
    * 1.1. Адрес сервера
    * 1.2. Используемый протокол
2. Структуры данных
    * 2.1. Общий формат ответа
    * 2.2. Пользователь
    * 2.3. Класс лемминга
    * 2.4. Таблица лидеров
3. Список запросов
    * 3.1. Общие ошибки
4. Подробно
    * 4.1. registration
    * 4.2. login
    * 4.3. logout
    * 4.4. chooseClass
    * 4.5. startGame
    * 4.6. triggerPopup
    * 4.7. gameStatus
    * 4.8. leaderboard
    * 4.9. getSpline
    

## 1. Общее
### 1.1. Адрес сервера
`http://lemmingstone.local/api`

### 1.2. Используемый протокол
API полностью реализовано на http(s). 

Формат возвращаемых значений `JSON`.

Все методы, если это особо не оговорено, имеют тип `GET`.


## 2. Структуры данных
### 2.1. Общий формат ответа
`T` - какие-то данные. В случае успешного ответа возвращается `result = 'ok'` и поле `data` с данными.

В случае ошибки возвращается `result = 'error'` и поле `error` с кодом и текстом ошибки
```
Answer<T>: {
    result: 'ok' | 'error';
    data?: T;
    error?: {
        code: number;
        text: string;
    };
}
```

### 2.2. Пользователь
```
User: {
    id: number;
    token: string;
    name: string;
    class?: string;
}
```

### 2.3. Класс лемминга
```
LemmingClass: {
    id: number;
    class: string;
    abilities: string[];
}
```

### 2.4. Таблица лидеров
```
LeaderboardEntry: {
    nickname: string;
    score: number;
    deaths: number;
}
```

## 3. Список запросов
| Название | О чем |
| - | - |
| registration | Регистрация пользователя |
| login | Авторизация пользователя |
| logout | Логаут пользователя |
| chooseClass | Выбор класса лемминга |
| startGame | Запуск новой игровой сессии |
| triggerPopup | Вызов всплывающего окна |
| gameStatus | Получение статистики текущей игры |
| leaderboard | Получение таблицы лидеров после игры |
| getSpline | Получение сплайновой апроксимации для отрисовки карты игры |

### 3.1. Общие ошибки
* `101` - если не передан параметр `method`
* `102` - если переданное значение в параметре `method` не обрабатывается
* `242` - не переданы все необходимые параметры


## 4. Подробно
### 4.3. registration
Зарегистрировать нового пользователя

**Параметры**
```
{
    login: string; - логин пользователя
    password: string; - хеш пароля: md5(login + password)
    name: string; - имя пользователя
}
```
**Успешный ответ**
```
    Answer<User>
```
**Ошибки**
* `1001` - такой логин уже существует
* `1004` - ошибка при регистрации пользователя


### 4.2. login
Авторизация пользователя в системе

**Параметры**
```
{
    login: string; - логин пользователя
    hash: string; - контрольная сумма, равная hash = md5(nd5(login + password) + rnd)
    rnd: number; - случайно целое число
}
```
**Успешный ответ**
```
    Answer<User>
```
**Ошибки**
* `1002` - неверный пароль
* `1005` - неверный логин


### 4.3. logout
Вылогин пользователя из системы

**Параметры**
```
{
    token: string
}
```
**Успешный ответ**
```
    Answer<true>
```
**Ошибки**
* `1003` - неверный токен


### 4.4. chooseClass
Выбор класса лемминга

**Параметры**
```
{
    "userId": number; - идентификатор пользователя
    "class": string; - класс лемминга
}
```

**Успешный ответ**
```
    Answer<true>
```

**Ошибки**
* `2001` - класс лемминга не найден
* `242` - не переданы все необходимые параметры


### 4.5. startGame
Запуск новой игры после выбора класса

**Параметры**
```
{
    "userId": number; - идентификатор пользователя
    "class": string; - класс лемминга
}
```

**Успешный ответ**
```
    Answer<{
        gameId:number;
    }>
```

**Ошибки**
* `2002` - ошибка при запуске игры
* `242` - не переданы все необходимые параметры


### 4.6. triggerPopup
Вызов всплыващеего окно

**Параметры**
```
{
    "gameId": number; - индентифактор текущей игры
    "popupType": string; - тип всплывающего окна
}
```

**Успешный ответ**
```
    Answer<{
        popupContent: string;
    }>
```

**Ошибки**
* `2003` - ошибка при открытии всплывающего окна 
* `242` - не переданы все необходимые параметры


### 4.7. gameStatus
Получение текущего состояния игры (очки, смерти, доступные карты)

**Параметры**
```
{
    "gameId": number; - индентифактор текущей игры
}
```

**Успешный ответ**
```
    Answer<{
        score: number;           
        deaths: number;         
        availableCards: string[];
    }>
```

**Ошибки**
* `2004` - ошибка при получении статуса игры
* `242` - не переданы все необходимые параметры


### 4.8. leaderboard
Получение таблицы лидеров с топ-очками и топ-смертями после завершения игры.

**Параметры**
```
{
    "gameId": number; - индентифактор текущей игры
}
```

**Успешный ответ**
```
    Answer<{
        topScored: LeaderboardEntry[];
        topDeaths: LeaderboardEntry[];
    }>
```

**Ошибки**
* `2005` - ошибка при получении таблицы лидеров 
* `242` - не переданы все необходимые параметры


### 4.9. getSpline
Метод для расчёта коэффициентов кубического сплайна на основе заданного набора точек.

**Параметры**
```
$points: array - массив точек, каждая точка представлена в виде ассоциативного массива с ключами 'x' и 'y', например:
[
    ['x' => 1, 'y' => 2],
    ['x' => 2, 'y' => 3],
    ...
]
```

**Успешный ответ**
```
    [
    'a' => array, // коэффициенты a (значения y)
    'b' => array, // коэффициенты b
    'c' => array, // коэффициенты c
    'd' => array, // коэффициенты d
    'h' => array  // разности по x между соседними точками
]
```

**Описание**
Метод использует алгоритм расчёта коэффициентов кубического сплайна для интерполяции заданного набора точек. На основе входного массива точек вычисляются массивы коэффициентов a, b, c, d, и промежуточные значения h, необходимые для дальнейших вычислений интерполируемых значений.

**Ошибки**
* `4001` - передан некорректный массив точек 
* `4002` - недостаточное количество точек для построения сплайна

